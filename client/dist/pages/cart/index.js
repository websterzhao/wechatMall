"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),_get=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../npm/classnames/index.js"),_index4=_interopRequireDefault(_index3),_index5=require("../../utils/index.js"),_data=require("./data.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var s=e.apply(this,arguments);return new Promise(function(o,a){return function t(e,n){try{var r=s[e](n),i=r.value}catch(e){return void a(e)}if(!r.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});o(i)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Cart=(_temp2=_class=function(){function a(){var e,t,n;_classCallCheck(this,a);for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=n=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(i)))).$usedState=["$compid__1","$compid__2","$compid__3","$compid__4","cartClass","showEidtBox","isLogin","isFixedBar","__fn_on"],n.config={navigationBarTitleText:"购物车",backgroundColor:"#f2efef",disableScroll:!0},n.customComponents=["Commondity","Goods","EditBox","BottomBar"],_possibleConstructorReturn(n,t)}var e,t,n,r,i,o,s,c;return _inherits(a,_index.Component),_createClass(a,[{key:"_constructor",value:function(){_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"_constructor",this).apply(this,arguments),this.state=_extends({isLogin:!0,isFixedBar:!1},(0,_data.getInitialState)()),this.scrollTop=0,this.pageScrollFn=(0,_index5.throttle)(this.isNeedFixedBar,200,this),this.$$refs=[]}},{key:"componentWillMount",value:function(){}},{key:"componentDidMount",value:function(){_index2.default.eventCenter.on("setState",this.setNewData.bind(this)),_index2.default.eventCenter.on("getChangeCartNum",this.getChangeCartNum.bind(this)),_index2.default.eventCenter.on("delCart",this.delCart.bind(this)),_index2.default.eventCenter.on("onShowEditBox",this.onShowEditBox.bind(this)),_index2.default.eventCenter.on("onInverseCheckDelCart",this.onInverseCheckDelCart.bind(this)),_index2.default.eventCenter.on("onCheckDelCart",this.onCheckDelCart.bind(this)),_index2.default.eventCenter.on("onFetchInvertCheckCart",this.onFetchInvertCheckCart.bind(this)),_index2.default.eventCenter.on("onFetchCheckCart",this.onFetchCheckCart.bind(this)),_index2.default.eventCenter.on("onFetchChangeAttr",this.onFetchChangeAttr.bind(this))}},{key:"setNewData",value:function(e){this.setState(_extends({},e))}},{key:"getChangeCartNum",value:(c=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_data.editCart)(t,"CHANGE_NUM");case 2:n=e.sent,this.setState(_extends({},n));case 4:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"delCart",value:(s=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_data.editCart)(t,"DEL");case 2:n=e.sent,this.setState(_extends({},n));case 4:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"onShowEditBox",value:function(e){var t=this.state.editSkuData,n=_extends({},t,{sku:e,showEidtBox:!0});this.setState({editSkuData:n})}},{key:"onHideEditBox",value:function(){var e=this.state.editSkuData,t=_extends({},e,{showEidtBox:!1});console.log(),this.setState({editSkuData:t})}},{key:"onInverseCheckDelCart",value:(o=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_data.inverseCheckDelCart)(this.state.commoditys,t,!1);case 2:n=e.sent,this.setState({commoditys:n.newCommoditys,checkDelAll:n.commoditysCheckDelAll});case 4:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"onCheckDelCart",value:(i=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_data.inverseCheckDelCart)(this.state.commoditys,t,!0);case 2:n=e.sent,this.setState({commoditys:n.newCommoditys,checkDelAll:n.commoditysCheckDelAll});case 4:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"onFetchInvertCheckCart",value:(r=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_data.editCart)(t,"INVERT_CHECK");case 2:n=e.sent,this.setState(_extends({},n));case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"onFetchCheckCart",value:(n=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,(0,_data.editCart)(t,"CHECK");case 3:n=e.sent,this.setState(_extends({},n));case 5:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"onFetchChangeAttr",value:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_data.editCart)(t,"CHANGE_ATTR");case 2:n=e.sent,this.setState(_extends({},n));case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){}},{key:"componentDidShow",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_data.getCartData)();case 2:t=e.sent,this.setState(_extends({},t));case 4:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"onViewScroll",value:function(e){this.pageScrollFn&&this.pageScrollFn(e.detail.scrollTop)}},{key:"isNeedFixedBar",value:function(e){var t=this.state.isFixedBar;45<(this.scrollTop=e)?t||this.setState({isFixedBar:!0}):t&&this.setState({isFixedBar:!1})}},{key:"_createData",value:function(e,t,n){this.__state=e||this.state||{},this.__props=t||this.props||{};var r=this.$prefix,i=(0,_index.genCompid)(r+"$compid__1"),o=(0,_index.genCompid)(r+"$compid__2"),a=(0,_index.genCompid)(r+"$compid__3"),s=(0,_index.genCompid)(r+"$compid__4"),c=this.__state,u=c.isLogin,d=c.isFixedBar,l=c.editSkuData,h=c.commoditys,p=c.isFetching,_=c.isEditStatus,f=c.checkCartNum,m=c.totalPrice,C=c.checkAll,x=c.checkDelAll,v=c.isSub,y=l.showEidtBox,g=0!==h.length,k=(0,_index4.default)("cart-scroll",{no_bottom:!g&&!u});return _index.propsManager.set({isFixedBar:d,isEditStatus:_,commoditys:h,isFetching:p,editSkuData:l},i),_index.propsManager.set({footmark:l.footmark},o),y&&_index.propsManager.set({onHideEditBox:this.onHideEditBox.bind(this),editSkuData:l},a),_index.propsManager.set({isLogin:u,isSub:v,isEditStatus:_,checkCartNum:f,totalPrice:m,checkAll:C,checkDelAll:x,commoditys:h},s),Object.assign(this.__state,{$compid__1:i,$compid__2:o,$compid__3:a,$compid__4:s,cartClass:k,showEidtBox:y}),this.__state}}]),a}(),_class.$$events=["onViewScroll"],_class.$$componentPath="pages/cart/index",_temp2);exports.default=Cart,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Cart,!0));