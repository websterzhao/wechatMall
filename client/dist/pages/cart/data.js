"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.inverseCheckDelCart=exports.editCart=exports.getCartData=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},getCartData=exports.getCartData=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_index4.getOpenId)();case 2:return t=e.sent,e.next=5,_index2.default.cloud.callFunction({name:"cart",data:{$url:"getCart",data:{_id:t}}});case 5:return r=e.sent,e.abrupt("return",handleCartData(r.result.data));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),editCart=exports.editCart=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_index4.getOpenId)();case 2:return n=e.sent,e.next=5,_index2.default.cloud.callFunction({name:"cart",data:{$url:"editCart",data:{_id:n,type:_index3.operate[r],skus:t}}});case 5:return a=e.sent,e.abrupt("return",handleCartData(a.result.data));case 7:case"end":return e.stop()}},e,this)}));return function(e,t){return r.apply(this,arguments)}}(),inverseCheckDelCart=exports.inverseCheckDelCart=function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var a,o,i,c,u,s,l,d,f,h,p,k;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(i=!(o=a=!0),c=void 0,e.prev=4,u=t[Symbol.iterator]();!(o=(s=u.next()).done);o=!0)l=s.value,d=l.shop,f=l.skus,h=!0,p=f.map(function(t){return 0!==r.filter(function(e){return e.skuId===t.skuId}).length&&(t=_extends({},t,{checkDel:n})),t.checkDel||(h=!1),t}),l.skus=p,d.checkDelAll=h,d.checkDelAll||(a=!1);e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),i=!0,c=e.t0;case 12:e.prev=12,e.prev=13,!o&&u.return&&u.return();case 15:if(e.prev=15,i)throw c;e.next=18;break;case 18:return e.finish(15);case 19:return e.finish(12);case 20:return k=t.map(function(e){return _extends({},e)}),e.abrupt("return",{newCommoditys:k,commoditysCheckDelAll:a});case 22:case"end":return e.stop()}},e,this,[[4,8,12,20],[13,,15,19]])}));return function(e,t,r){return n.apply(this,arguments)}}();exports.getInitialState=getInitialState,exports.handleCartData=handleCartData;var _index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../constants/index.js"),_index4=require("../../utils/index.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var c=e.apply(this,arguments);return new Promise(function(o,i){return function t(e,r){try{var n=c[e](r),a=n.value}catch(e){return void i(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});o(a)}("next")})}}function getInitialState(){return{commoditys:[],offSales:[],editSkuData:{showEidtBox:!1},diviner:[],footmark:[],couponData:{showCouponList:!1},checkCartNum:0,totalPrice:0,checkAll:!1,checkDelAll:!1,isEditStatus:!1,isFetching:!1,isSub:!1}}function handleCartData(e){if(!e||!e.cartInfo)return{commoditys:[],offSales:[],checkCartNum:0,totalPrice:0,checkAll:!1};var t,o={},i=0,c=0!==e.cartNum,r=e.cartInfo,n=e.shopMap[0];for(var a in t=(0,_index4.parseMoney)(e.totalPrice),n){var u=n[a]||{fullLogoUri:"https://img11.360buyimg.com/ling/jfs/t24292/40/1063566259/5338/454eb23d/5b4f2575N485ac2d0.jpg",logoUri:"/ling/jfs/t24292/40/1063566259/5338/454eb23d/5b4f2575N485ac2d0.jpg",title:"TARO",venderId:""};u.checkAll=!0,u.showCheckAll=!1,u.checkDelAll=!1;var s={};s.shop=u,s.skus=[],o[a]=s}return r.forEach(function(e){var t=e.venderId,r=o[t].skus,n=o[t].shop;n.showCheckAll=!0;var a={};a.skuId=e.skuId,a.num=e.num,a.main=e.info,a.isCheck=e.isCheck,a.colorInfo=e.info.colorInfo,a.sizeInfo=e.info.sizeInfo,a.checkDel=!1,a.isCheck&&(i+=a.num),a.isOutOfStock=!1,a.isCheck||(n.checkAll=!1),n.checkAll||(c=!1),r.push(a)}),99<i&&(i="99+"),{commoditys:Object.values(o),offSales:[],checkCartNum:i,totalPrice:t,checkAll:c}}